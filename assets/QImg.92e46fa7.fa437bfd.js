import{k as H,X as u,$ as n,R as I,o as L,f as l,M as O,s as Q,j as X}from"./index.8b3fe72c.js";import{d as A,h as S}from"./vm.84167867.17286884.js";import{f as E}from"./render.019faeb2.42954859.js";import{f as k}from"./use-timeout.71fb8d69.4f4dec91.js";const F={ratio:[String,Number]};function G(i,o){return n(()=>{const s=Number(i.ratio||(o!==void 0?o.value:void 0));return isNaN(s)!==!0&&s>0?{paddingBottom:`${100/s}%`}:null})}const J=1.7778;var U=H({name:"QImg",props:{...F,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:J},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(i,{slots:o,emit:s}){const h=u(i.initialRatio),y=G(i,h),v=X(),{registerTimeout:w,removeTimeout:m}=k(),{registerTimeout:z,removeTimeout:_}=k(),f=n(()=>i.placeholderSrc!==void 0?{src:i.placeholderSrc}:null),N=n(()=>i.errorSrc!==void 0?{src:i.errorSrc,__qerror:!0}:null),e=[u(null),u(f.value)],t=u(0),g=u(!1),c=u(!1),$=n(()=>`q-img q-img--${i.noNativeMenu===!0?"no-":""}menu`),j=n(()=>({width:i.width,height:i.height})),T=n(()=>`q-img__image ${i.imgClass!==void 0?i.imgClass+" ":""}q-img__image--with${i.noTransition===!0?"out":""}-transition q-img__image--`),B=n(()=>({...i.imgStyle,objectFit:i.fit,objectPosition:i.position}));function C(){if(_(),i.loadingShowDelay===0){g.value=!0;return}z(()=>{g.value=!0},i.loadingShowDelay)}function p(){_(),g.value=!1}function R({target:r}){S(v)===!1&&(m(),h.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,b(r,1))}function b(r,a){a===1e3||S(v)===!0||(r.complete===!0?x(r):w(()=>{b(r,a+1)},50))}function x(r){S(v)!==!0&&(t.value=t.value^1,e[t.value].value=null,p(),r.getAttribute("__qerror")!=="true"&&(c.value=!1),s("load",r.currentSrc||r.src))}function D(r){m(),p(),c.value=!0,e[t.value].value=N.value,e[t.value^1].value=f.value,s("error",r)}function q(r){const a=e[r].value,d={key:"img_"+r,class:T.value,style:B.value,alt:i.alt,crossorigin:i.crossorigin,decoding:i.decoding,referrerpolicy:i.referrerpolicy,height:i.height,width:i.width,loading:i.loading,fetchpriority:i.fetchpriority,"aria-hidden":"true",draggable:i.draggable,...a};return t.value===r?Object.assign(d,{class:d.class+"current",onLoad:R,onError:D}):d.class+="loaded",l("div",{class:"q-img__container absolute-full",key:"img"+r},l("img",d))}function M(){return g.value===!1?l("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},E(o[c.value===!0?"error":"default"])):l("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},o.loading!==void 0?o.loading():i.noSpinner===!0?void 0:[l(A,{color:i.spinnerColor,size:i.spinnerSize})])}{let r=function(){Q(()=>i.src||i.srcset||i.sizes?{src:i.src,srcset:i.srcset,sizes:i.sizes}:null,a=>{m(),c.value=!1,a===null?(p(),e[t.value^1].value=f.value):C(),e[t.value].value=a},{immediate:!0})};I.value===!0?L(r):r()}return()=>{const r=[];return y.value!==null&&r.push(l("div",{key:"filler",style:y.value})),e[0].value!==null&&r.push(q(0)),e[1].value!==null&&r.push(q(1)),r.push(l(O,{name:"q-transition--fade"},M)),l("div",{key:"main",class:$.value,style:j.value,role:"img","aria-label":i.alt},r)}}});export{U as Y};
